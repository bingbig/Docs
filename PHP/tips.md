# PHP编程技巧与优化

:::tip
[来源：未知] 侵权请联系，删。
:::

PHP语言以其简单易学而闻名，但一些初学者经常会写出一些性能低下的PHP代码，这会严重影响整套系统的运行效率，本文我们为大家收集了一些PHP 编程技巧与优化，希望PHP初学者能认真阅读以下的编辑技巧，并养成良好的PHP编程习惯！

1. 尽量采用大量的PHP内置函数。
2. 使用 `echo` 代替 `print`，并且使用 `echo` 的多重参数（译注：指用逗号而不是句点）代替字符串连接，比如 `echo $str1,$str2`;
3. 不要把方法细分得过多，仔细想想你真正打算重用的是哪些代码？
4. 在执行`for`循环之前确定最大循环数，不要每循环一次都计算最大值。
5. 注销那些不用的变量尤其是大数组，以便释放内存。
6. 并非要用类实现所有的数据结构，数组也很有用。
7. `$row['id']`的效率是`$row[id]`的7倍。
8. 在包含文件时使用完整路径，解析操作系统路径所需的时间会更少。
9. 如果你想知道脚本开始执行（译注：即服务器端收到客户端请求）的时刻，使用 `$_SERVER['REQUEST_TIME']` 要好于`time()`。
10. 函数代替正则表达式完成相同功能，`str_replace`函数比`preg_replace` 函数快，但 `strtr` 函数的效率是`str_replace` 函数的四倍。
11. 注意代码编写的缩进。
12. 如果一个字符串替换函数，可接受数组或字符作为参数，并且参数长度不太长，那么可以考虑额外写一段替换代码，使得每次传递参数是一个字符，而不是只写一行代码接受数组作为查询和替换的参数。
13. 使用选择分支语句（译注：即`switch case`）好于使用多个`if`，`else if` 语句。
14. 用`@`屏蔽错误消息的做法非常低效。
15. 打开Apache的mod_deflate模块。**？？？**
16. 数据库连接当使用完毕时应关掉。
17. 错误消息代价昂贵。
18. 尽量不要在for循环中使用函数，比如`for ($x=0; $x < count($array); $x)`每循环一次都会调用`count()`函数。
19. 在方法中递增局部变量，速度是最快的。几乎与在函数中调用局部变量的速度相当。
20. 递增一个全局变量要比递增一个局部变量慢2倍。
21. 递增一个对象属性（如：`$this->prop++`）要比递增一个局部变量慢3倍。
22. 递增一个未预定义的局部变量要比递增一个预定义的局部变量慢9至10倍。
23. 仅定义一个局部变量而没在函数中调用它，同样会减慢速度（其程度相当于递增一个局部变量），PHP大概会检查看是否存在全局变量
24. 方法调用看来与类中定义的方法的数量无关，因为我（在测试方法之前和之后都）添加了10个方法，但性能上没有变化。
25. 派生类中的方法运行起来要快于在基类中定义的同样的方法。
26. 调用带有一个参数的空函数，其花费的时间相当于执行7至8次的局部变量递增操作。类似的方法调用所花费的时间接近于15次的局部变量递增操作。
27. 用单引号代替双引号来包含字符串，这样做会更快一些。因为PHP会在双引号包围的字符串中搜寻变量，单引号则不会。当然，只有当你不需要在字符串中包含变量时才可以这么做。
28. Apache解析一个PHP脚本的时间要比解析一个静态HTML页面慢2至10倍。尽量多用静态HTML页面，少用脚本。
29. 除非脚本可以缓存，否则每次调用时都会重新编译一次。引入一套PHP缓存机制通常可以提升25%至100%的性能，以免除编译开销。
30. 尽量做缓存，可使用memcached。memcached是一款高性能的内存对象缓存系统，可用来加速动态Web应用程序，减轻数据库负载。对运算码(OP code)的缓存很有用，使得脚本不必为每个请求做重新编译。
31. 当操作字符串并需要检验其长度是否满足某种要求时，你想当然地会使用`strlen()`函数。此函数执行起来相当快，因为它不做任何计算，只返回在zval 结构（C的内置数据结构，用于存储PHP变量）中存储的已知字符串长度。但是，由于`strlen()`是函数，多多少少会有些慢，因为函数调用会经过诸多步骤，如字母小写化。在某些情况下，你可以使用`isset()` 技巧加速执行你的代码。

```php
if (strlen($foo) < 5) { 
	echo "Foo is too short"; 
}
if (!isset($foo{5})) {
	echo "Foo is too short"; 
}
```
32. 如果能将类的方法定义成 `static`，就尽量定义成 `static`，它的速度会提升将近4倍。
33. 不要使用`array_key_exists`，用`isset`来判断键值是否在数组中存在
34. 避免使用`__set__`，`__get__`等魔术方法
35. 使用 `include/require` 代替 `include_once` / `require_once`，且尽量使用绝对路径
36. 不要把`count`/`strlen`/`sizeof`等放到`for`循环的条件语句中
37. 尽量使用 `foreach` 代替 `for`/`while`
38. 读取小文件使用`fread`，读取大文件使用`file_get_contents`，特大的文件使用`fseek`
39. 使用 `ip2long()` 和 `long2ip()` 函数来把 IP 地址转化成整型存储，可以使计算一个特定的地址是不是在一个区段内更简单，而且加快了搜索和排序的速度
40. 在验证 email 地址时使用 `checkdnsrr()` 函数验证域名是否存在，这个内置函数能够确认指定的域名能够解析成 IP 地址
41. 考虑抛弃 `mysql_*` 系列函数改用改进版的 `mysqli_*` 系列函数
42. 学会爱上三元运算符
43. 用 `highlight_file()` 来自动的打印出格式化的很漂亮的源代码
44. 使用 `error_reporting(0)` 函数来防止用户看到潜在的敏感错误信息。在理想情况下，发布服务器应该在 php.ini 里完全禁止。但是如果你用的是一个共享的 web 服务器的话，你没有自己的 php、ini 文件，那么这种情况下你最好的选择就是在所有脚本的第一行前加上 `error_reporting(0)`
45. 在网数据库中存储很大的字符串之前使用 `gzcompress()` 和 `gzuncompress()` 来显式的压缩/解压字符串
46. 通过"引用"传递参数的方法从一个函数中得到多个返回值
47. 完全理解"魔术引号"和 SQL 注入的危险性，最简单的防止sql注入的方法：在php、ini中将`magic_quotes`设置为 `On` ，使用 `mysql_real_escape_string()` 函数转义
48. 对global变量，应该用完就`unset()`掉；
49. 不要相信用户提交的数据，一定使用 `htmlentities()`或 `htmlspecialchars()` 先进行转义
50. 当执行变量 `$i` 的递增或递减时，`$i++` 会比 `++$i` 慢一些。这种差异是PHP特有的，并不适用于其他语言，所以请不要修改你的C或Java代码并指望它们能立即变快，没用的。`++$i` 更快是因为它只需要3条指令(opcodes)，`$i++` 则需要4条指令。后置递增实际上会产生一个临时变量，这个临时变量随后被递增。而前置递增直接在原值上递增
51. 并不是事必面向对象(OOP)，面向对象往往开销很大，每个方法和对象调用都会消耗很多内存
52. 如果在代码中存在大量耗时的函数，你可以考虑用C扩展的方式实现
53. 评估检验(profile)你的代码。检验器会告诉你，代码的哪些部分消耗了多少时间。Xdebug调试器包含了检验程序，评估检验总体上可以显示出代码的瓶颈
54. `mod_zip` 可作为Apache模块，用来即时压缩你的数据，并可让数据传输量降低80%
55. 尽量的少进行文件操作，虽然PHP的文件操作效率也不低的
56. 优化Select SQL语句，在可能的情况下尽量少的进行Insert、Update操作
57. 循环内部不要声明变量，尤其是大变量：对象(这好像不只是PHP里面要注意的问题吧？)
58. 多维数组尽量不要循环嵌套赋值

